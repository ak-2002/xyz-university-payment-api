2025-07-10 13:05:22.457 +03:00 [INF] Ensuring database is created {"MachineName":"DESKTOP-F3AMJ10","ThreadId":1,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:23.518 +03:00 [INF] Database created successfully {"MachineName":"DESKTOP-F3AMJ10","ThreadId":1,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:23.522 +03:00 [INF] Seeding default roles and permissions {"MachineName":"DESKTOP-F3AMJ10","ThreadId":1,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:24.066 +03:00 [INF] Valid data already seeded, skipping seeding process {"SourceContext":"xyz_university_payment_api.Core.Application.Services.AuthorizationService","MachineName":"DESKTOP-F3AMJ10","ThreadId":6,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:24.082 +03:00 [INF] Default roles and permissions seeded successfully {"MachineName":"DESKTOP-F3AMJ10","ThreadId":6,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:24.401 +03:00 [INF] XYZ University Payment API started successfully {"MachineName":"DESKTOP-F3AMJ10","ThreadId":6,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:24.572 +03:00 [INF] Configured endpoint PaymentProcessedMessage, Consumer: xyz_university_payment_api.Core.Application.Services.PaymentProcessedMessageConsumer {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":6,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:24.584 +03:00 [INF] Configured endpoint PaymentFailedMessage, Consumer: xyz_university_payment_api.Core.Application.Services.PaymentFailedMessageConsumer {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":6,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:24.594 +03:00 [INF] Configured endpoint PaymentValidationMessage, Consumer: xyz_university_payment_api.Core.Application.Services.PaymentValidationMessageConsumer {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":6,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:24.965 +03:00 [INF] Bus started: "rabbitmq://localhost/" {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:47.754 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'. {"EventId":{"Id":20504,"Name":"Microsoft.EntityFrameworkCore.Query.MultipleCollectionIncludeWarning"},"SourceContext":"Microsoft.EntityFrameworkCore.Query","ActionId":"7673dcc4-d6c9-4a74-8d6d-ed8cca6ce933","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.Login (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQA:00000002","RequestPath":"/api/Authorization/login","ConnectionId":"0HNDVJ59OBEQA","MachineName":"DESKTOP-F3AMJ10","ThreadId":15,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:05:47.788 +03:00 [INF] Generated access token for user S67890 with 0 roles and 0 permissions {"SourceContext":"xyz_university_payment_api.Core.Application.Services.JwtTokenService","ActionId":"7673dcc4-d6c9-4a74-8d6d-ed8cca6ce933","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.Login (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQA:00000002","RequestPath":"/api/Authorization/login","ConnectionId":"0HNDVJ59OBEQA","MachineName":"DESKTOP-F3AMJ10","ThreadId":15,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:00.959 +03:00 [INF] Generated access token for user admin with 1 roles and 16 permissions {"SourceContext":"xyz_university_payment_api.Core.Application.Services.JwtTokenService","ActionId":"7673dcc4-d6c9-4a74-8d6d-ed8cca6ce933","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.Login (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQI:00000002","RequestPath":"/api/Authorization/login","ConnectionId":"0HNDVJ59OBEQI","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:01.097 +03:00 [INF] V3 GetAdminStats endpoint called {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQJ:00000002","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQJ","MachineName":"DESKTOP-F3AMJ10","ThreadId":3,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:01.106 +03:00 [INF] Retrieving all students {"SourceContext":"xyz_university_payment_api.Core.Application.Services.StudentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQJ:00000002","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQJ","MachineName":"DESKTOP-F3AMJ10","ThreadId":3,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:01.131 +03:00 [INF] Retrieving all payments {"SourceContext":"xyz_university_payment_api.Core.Application.Services.PaymentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQJ:00000002","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQJ","MachineName":"DESKTOP-F3AMJ10","ThreadId":3,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:01.175 +03:00 [INF] V3 GetAdminStats endpoint called {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQI:00000004","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQI","MachineName":"DESKTOP-F3AMJ10","ThreadId":3,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:01.181 +03:00 [INF] Retrieving all students {"SourceContext":"xyz_university_payment_api.Core.Application.Services.StudentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQI:00000004","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQI","MachineName":"DESKTOP-F3AMJ10","ThreadId":3,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:01.189 +03:00 [INF] Retrieving all payments {"SourceContext":"xyz_university_payment_api.Core.Application.Services.PaymentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQI:00000004","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQI","MachineName":"DESKTOP-F3AMJ10","ThreadId":3,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:03.487 +03:00 [INF] GetUsers endpoint called by user: admin {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQJ:00000004","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQJ","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:03.521 +03:00 [INF] Total users in database: 10 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQJ:00000004","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQJ","MachineName":"DESKTOP-F3AMJ10","ThreadId":30,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:03.554 +03:00 [INF] Returning 10 users {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQJ:00000004","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQJ","MachineName":"DESKTOP-F3AMJ10","ThreadId":30,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:03.564 +03:00 [INF] GetUsers endpoint called by user: admin {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQI:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQI","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:03.572 +03:00 [INF] Total users in database: 10 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQI:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQI","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:03.579 +03:00 [INF] Returning 10 users {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQI:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQI","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:08:26.432 +03:00 [INF] Generated access token for user S67890 with 0 roles and 0 permissions {"SourceContext":"xyz_university_payment_api.Core.Application.Services.JwtTokenService","ActionId":"7673dcc4-d6c9-4a74-8d6d-ed8cca6ce933","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.Login (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQK:00000002","RequestPath":"/api/Authorization/login","ConnectionId":"0HNDVJ59OBEQK","MachineName":"DESKTOP-F3AMJ10","ThreadId":30,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:09:50.917 +03:00 [INF] Starting student role fix... {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"fce7e42b-b1cc-4721-aef0-a6009109e337","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQM:00000001","RequestPath":"/api/v3/user/fix-student-roles","ConnectionId":"0HNDVJ59OBEQM","MachineName":"DESKTOP-F3AMJ10","ThreadId":34,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:09:51.112 +03:00 [INF] Assigned Student role to user S12345 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"fce7e42b-b1cc-4721-aef0-a6009109e337","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQM:00000001","RequestPath":"/api/v3/user/fix-student-roles","ConnectionId":"0HNDVJ59OBEQM","MachineName":"DESKTOP-F3AMJ10","ThreadId":34,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:09:51.148 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'xyz_university_payment_api.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c0d59ef5-0a95-4658-851a-688d671b8305
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"fce7e42b-b1cc-4721-aef0-a6009109e337","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQM:00000001","RequestPath":"/api/v3/user/fix-student-roles","ConnectionId":"0HNDVJ59OBEQM","MachineName":"DESKTOP-F3AMJ10","ThreadId":34,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c0d59ef5-0a95-4658-851a-688d671b8305
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-10 13:09:51.200 +03:00 [ERR] Error fixing student roles {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"fce7e42b-b1cc-4721-aef0-a6009109e337","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQM:00000001","RequestPath":"/api/v3/user/fix-student-roles","ConnectionId":"0HNDVJ59OBEQM","MachineName":"DESKTOP-F3AMJ10","ThreadId":34,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c0d59ef5-0a95-4658-851a-688d671b8305
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles() in C:\Users\wanja\Desktop\jj\xyz-university-payment-api\xyz-university-payment-api\Presentation\Controllers\V3\UserControllerV3.cs:line 429
2025-07-10 13:14:41.501 +03:00 [INF] Starting student role fix... {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"fce7e42b-b1cc-4721-aef0-a6009109e337","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQN:00000001","RequestPath":"/api/v3/user/fix-student-roles","ConnectionId":"0HNDVJ59OBEQN","MachineName":"DESKTOP-F3AMJ10","ThreadId":32,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:14:41.532 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'xyz_university_payment_api.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c0d59ef5-0a95-4658-851a-688d671b8305
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"fce7e42b-b1cc-4721-aef0-a6009109e337","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQN:00000001","RequestPath":"/api/v3/user/fix-student-roles","ConnectionId":"0HNDVJ59OBEQN","MachineName":"DESKTOP-F3AMJ10","ThreadId":32,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c0d59ef5-0a95-4658-851a-688d671b8305
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-10 13:14:41.565 +03:00 [ERR] Error fixing student roles {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"fce7e42b-b1cc-4721-aef0-a6009109e337","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQN:00000001","RequestPath":"/api/v3/user/fix-student-roles","ConnectionId":"0HNDVJ59OBEQN","MachineName":"DESKTOP-F3AMJ10","ThreadId":32,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c0d59ef5-0a95-4658-851a-688d671b8305
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.FixStudentRoles() in C:\Users\wanja\Desktop\jj\xyz-university-payment-api\xyz-university-payment-api\Presentation\Controllers\V3\UserControllerV3.cs:line 429
2025-07-10 13:14:50.065 +03:00 [INF] Starting database cleanup... {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"cf7d29df-42b1-4b8f-8fb1-ab30447e65da","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.CleanupDatabase (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQN:00000002","RequestPath":"/api/v3/user/cleanup-database","ConnectionId":"0HNDVJ59OBEQN","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:14:50.077 +03:00 [WRN] Found 1 empty role names, removing them {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"cf7d29df-42b1-4b8f-8fb1-ab30447e65da","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.CleanupDatabase (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQN:00000002","RequestPath":"/api/v3/user/cleanup-database","ConnectionId":"0HNDVJ59OBEQN","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:14:50.101 +03:00 [INF] Removed 1 empty roles {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"cf7d29df-42b1-4b8f-8fb1-ab30447e65da","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.CleanupDatabase (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQN:00000002","RequestPath":"/api/v3/user/cleanup-database","ConnectionId":"0HNDVJ59OBEQN","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:47.221 +03:00 [INF] Generated access token for user admin with 1 roles and 16 permissions {"SourceContext":"xyz_university_payment_api.Core.Application.Services.JwtTokenService","ActionId":"7673dcc4-d6c9-4a74-8d6d-ed8cca6ce933","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.Login (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000002","RequestPath":"/api/Authorization/login","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":29,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:47.284 +03:00 [INF] V3 GetAdminStats endpoint called {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000002","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:47.294 +03:00 [INF] Retrieving all students {"SourceContext":"xyz_university_payment_api.Core.Application.Services.StudentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000002","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:47.306 +03:00 [INF] Retrieving all payments {"SourceContext":"xyz_university_payment_api.Core.Application.Services.PaymentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000002","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:47.317 +03:00 [INF] V3 GetAdminStats endpoint called {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000004","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:47.323 +03:00 [INF] Retrieving all students {"SourceContext":"xyz_university_payment_api.Core.Application.Services.StudentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000004","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:47.330 +03:00 [INF] Retrieving all payments {"SourceContext":"xyz_university_payment_api.Core.Application.Services.PaymentService","ActionId":"c77dc361-e1f4-4e2d-b6fe-17f419e8c947","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.DashboardController.GetAdminStats (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000004","RequestPath":"/api/v3/Dashboard/admin-stats","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:49.461 +03:00 [INF] GetUsers endpoint called by user: admin {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":29,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:49.461 +03:00 [INF] GetUsers endpoint called by user: admin {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000004","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:49.481 +03:00 [INF] Total users in database: 11 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:49.484 +03:00 [INF] Total users in database: 11 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000004","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":29,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:49.500 +03:00 [INF] Returning 11 users {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:49.500 +03:00 [INF] Returning 11 users {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000004","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":29,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:51.538 +03:00 [INF] GetUsers endpoint called by user: admin {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000008","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":29,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:51.538 +03:00 [INF] GetUsers endpoint called by user: admin {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":38,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:51.556 +03:00 [INF] Total users in database: 11 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":29,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:51.556 +03:00 [INF] Total users in database: 11 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000008","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":38,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:51.575 +03:00 [INF] Returning 11 users {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQR:00000006","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQR","MachineName":"DESKTOP-F3AMJ10","ThreadId":29,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:51.575 +03:00 [INF] Returning 11 users {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"618fc88c-a6d1-43b6-8ec4-fd8555c3fe8a","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.GetUsers (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQQ:00000008","RequestPath":"/api/v3/user/users","ConnectionId":"0HNDVJ59OBEQQ","MachineName":"DESKTOP-F3AMJ10","ThreadId":38,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:59.850 +03:00 [INF] Assigning role to user 50. RoleName: 'Student' (Length: 7) {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"6ec79d79-8f81-4777-9ae8-4e0aa1a52348","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQS:00000002","RequestPath":"/api/v3/user/users/50/roles","ConnectionId":"0HNDVJ59OBEQS","MachineName":"DESKTOP-F3AMJ10","ThreadId":37,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:20:59.885 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'xyz_university_payment_api.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Users' with unique index 'IX_Users_Email'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5e9bd55-587a-4ccc-8493-69c871be24ec
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"6ec79d79-8f81-4777-9ae8-4e0aa1a52348","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQS:00000002","RequestPath":"/api/v3/user/users/50/roles","ConnectionId":"0HNDVJ59OBEQS","MachineName":"DESKTOP-F3AMJ10","ThreadId":37,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Users' with unique index 'IX_Users_Email'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5e9bd55-587a-4ccc-8493-69c871be24ec
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-10 13:20:59.915 +03:00 [ERR] Error assigning role to user 50 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"6ec79d79-8f81-4777-9ae8-4e0aa1a52348","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQS:00000002","RequestPath":"/api/v3/user/users/50/roles","ConnectionId":"0HNDVJ59OBEQS","MachineName":"DESKTOP-F3AMJ10","ThreadId":37,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Users' with unique index 'IX_Users_Email'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5e9bd55-587a-4ccc-8493-69c871be24ec
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole(Int32 id, AssignRoleDto assignRoleDto) in C:\Users\wanja\Desktop\jj\xyz-university-payment-api\xyz-university-payment-api\Presentation\Controllers\V3\UserControllerV3.cs:line 257
2025-07-10 13:21:09.966 +03:00 [INF] Assigning role to user 50. RoleName: 'Staff' (Length: 5) {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"6ec79d79-8f81-4777-9ae8-4e0aa1a52348","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQT:00000002","RequestPath":"/api/v3/user/users/50/roles","ConnectionId":"0HNDVJ59OBEQT","MachineName":"DESKTOP-F3AMJ10","ThreadId":37,"ProcessId":19652,"Application":"XYZ University Payment API"}
2025-07-10 13:21:09.984 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'xyz_university_payment_api.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Users' with unique index 'IX_Users_Email'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5e9bd55-587a-4ccc-8493-69c871be24ec
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"6ec79d79-8f81-4777-9ae8-4e0aa1a52348","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQT:00000002","RequestPath":"/api/v3/user/users/50/roles","ConnectionId":"0HNDVJ59OBEQT","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Users' with unique index 'IX_Users_Email'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5e9bd55-587a-4ccc-8493-69c871be24ec
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-10 13:21:10.011 +03:00 [ERR] Error assigning role to user 50 {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3","ActionId":"6ec79d79-8f81-4777-9ae8-4e0aa1a52348","ActionName":"xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole (xyz-university-payment-api)","RequestId":"0HNDVJ59OBEQT:00000002","RequestPath":"/api/v3/user/users/50/roles","ConnectionId":"0HNDVJ59OBEQT","MachineName":"DESKTOP-F3AMJ10","ThreadId":39,"ProcessId":19652,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Users' with unique index 'IX_Users_Email'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5e9bd55-587a-4ccc-8493-69c871be24ec
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xyz_university_payment_api.Presentation.Controllers.V3.UserControllerV3.AssignRole(Int32 id, AssignRoleDto assignRoleDto) in C:\Users\wanja\Desktop\jj\xyz-university-payment-api\xyz-university-payment-api\Presentation\Controllers\V3\UserControllerV3.cs:line 257
2025-07-10 13:26:44.762 +03:00 [INF] Bus stopped: "rabbitmq://localhost/" {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":34,"ProcessId":19652,"Application":"XYZ University Payment API"}
