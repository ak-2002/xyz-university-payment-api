2025-07-07 20:11:31.262 +03:00 [INF] Ensuring database is created {"MachineName":"DESKTOP-F3AMJ10","ThreadId":1,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:41.879 +03:00 [INF] Database created successfully {"MachineName":"DESKTOP-F3AMJ10","ThreadId":1,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:42.018 +03:00 [INF] Seeding default roles and permissions {"MachineName":"DESKTOP-F3AMJ10","ThreadId":1,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:43.692 +03:00 [WRN] Found 1 users with invalid data, removing them {"SourceContext":"xyz_university_payment_api.Core.Application.Services.AuthorizationService","MachineName":"DESKTOP-F3AMJ10","ThreadId":10,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:44.706 +03:00 [INF] Removed 1 invalid users {"SourceContext":"xyz_university_payment_api.Core.Application.Services.AuthorizationService","MachineName":"DESKTOP-F3AMJ10","ThreadId":10,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:46.608 +03:00 [WRN] Found 1 roles with invalid names, removing them {"SourceContext":"xyz_university_payment_api.Core.Application.Services.AuthorizationService","MachineName":"DESKTOP-F3AMJ10","ThreadId":10,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:46.815 +03:00 [INF] Removed 1 invalid roles {"SourceContext":"xyz_university_payment_api.Core.Application.Services.AuthorizationService","MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:47.087 +03:00 [INF] Valid data already seeded, skipping seeding process {"SourceContext":"xyz_university_payment_api.Core.Application.Services.AuthorizationService","MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:47.148 +03:00 [INF] Default roles and permissions seeded successfully {"MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:47.560 +03:00 [INF] XYZ University Payment API started successfully {"MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:48.106 +03:00 [INF] Configured endpoint PaymentProcessedMessage, Consumer: xyz_university_payment_api.Core.Application.Services.PaymentProcessedMessageConsumer {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:48.166 +03:00 [INF] Configured endpoint PaymentFailedMessage, Consumer: xyz_university_payment_api.Core.Application.Services.PaymentFailedMessageConsumer {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:48.199 +03:00 [INF] Configured endpoint PaymentValidationMessage, Consumer: xyz_university_payment_api.Core.Application.Services.PaymentValidationMessageConsumer {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":8,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:11:49.373 +03:00 [INF] Bus started: "rabbitmq://localhost/" {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":5,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:13:21.605 +03:00 [WRN] Failed to determine the https port for redirect. {"EventId":{"Id":3,"Name":"FailedToDeterminePort"},"SourceContext":"Microsoft.AspNetCore.HttpsPolicy.HttpsRedirectionMiddleware","RequestId":"0HNDTF60LIOHE:00000001","RequestPath":"/api/Authorization/cleanup-corrupted-data","ConnectionId":"0HNDTF60LIOHE","MachineName":"DESKTOP-F3AMJ10","ThreadId":13,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:15:47.735 +03:00 [INF] Authorization action: RolesAssignedToUser on User 11 by System {"SourceContext":"xyz_university_payment_api.Core.Application.Services.AuthorizationService","ActionId":"21d3c99a-bef9-4ce1-ac87-6723f6772c2a","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.AssignRolesToExistingUsers (xyz-university-payment-api)","RequestId":"0HNDTF60LIOHG:00000001","RequestPath":"/api/Authorization/assign-roles-to-existing-users","ConnectionId":"0HNDTF60LIOHG","MachineName":"DESKTOP-F3AMJ10","ThreadId":16,"ProcessId":188,"Application":"XYZ University Payment API"}
2025-07-07 20:15:47.857 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'xyz_university_payment_api.Infrastructure.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61e84b48-5ba2-4de2-84a9-c58d6fb0cc41
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken) {"EventId":{"Id":10000,"Name":"Microsoft.EntityFrameworkCore.Update.SaveChangesFailed"},"SourceContext":"Microsoft.EntityFrameworkCore.Update","ActionId":"21d3c99a-bef9-4ce1-ac87-6723f6772c2a","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.AssignRolesToExistingUsers (xyz-university-payment-api)","RequestId":"0HNDTF60LIOHG:00000001","RequestPath":"/api/Authorization/assign-roles-to-existing-users","ConnectionId":"0HNDTF60LIOHG","MachineName":"DESKTOP-F3AMJ10","ThreadId":13,"ProcessId":188,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61e84b48-5ba2-4de2-84a9-c58d6fb0cc41
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-07 20:15:48.010 +03:00 [ERR] Error assigning roles to existing users {"SourceContext":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController","ActionId":"21d3c99a-bef9-4ce1-ac87-6723f6772c2a","ActionName":"xyz_university_payment_api.Presentation.Controllers.AuthorizationController.AssignRolesToExistingUsers (xyz-university-payment-api)","RequestId":"0HNDTF60LIOHG:00000001","RequestPath":"/api/Authorization/assign-roles-to-existing-users","ConnectionId":"0HNDTF60LIOHG","MachineName":"DESKTOP-F3AMJ10","ThreadId":13,"ProcessId":188,"Application":"XYZ University Payment API"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Roles' with unique index 'IX_Roles_Name'. The duplicate key value is ().
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61e84b48-5ba2-4de2-84a9-c58d6fb0cc41
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xyz_university_payment_api.Core.Application.Services.AuthorizationService.AssignRolesToUserAsync(AssignRolesToUserDto assignRolesDto) in C:\Users\wanja\Desktop\jj\xyz-university-payment-api\xyz-university-payment-api\Core\Application\Services\AuthorizationService.cs:line 678
   at xyz_university_payment_api.Presentation.Controllers.AuthorizationController.AssignRolesToExistingUsers() in C:\Users\wanja\Desktop\jj\xyz-university-payment-api\xyz-university-payment-api\Presentation\Controllers\AuthorizationController.cs:line 2015
2025-07-07 20:19:50.054 +03:00 [INF] Bus stopped: "rabbitmq://localhost/" {"SourceContext":"MassTransit","MachineName":"DESKTOP-F3AMJ10","ThreadId":15,"ProcessId":188,"Application":"XYZ University Payment API"}
